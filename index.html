<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UK National River Flow Archive Data from R • rnrfa</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="UK National River Flow Archive Data from R">
<meta property="og:description" content='Utility functions to retrieve data from the UK National River Flow
  Archive (&lt;https://nrfa.ceh.ac.uk/&gt;, terms and conditions:
  &lt;https://nrfa.ceh.ac.uk/costs-terms-and-conditions&gt;).
  The package contains R wrappers to the UK NRFA data temporary-API. There are
  functions to retrieve stations falling in a bounding box, to generate a map
  and extracting time series and general information. The package is fully
  described in Vitolo et al (2016) "rnrfa: An R package to Retrieve, Filter and
  Visualize Data from the UK National River Flow Archive"
  &lt;https://journal.r-project.org/archive/2016/RJ-2016-036/RJ-2016-036.pdf&gt;.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rnrfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://journal.r-project.org/archive/2016/RJ-2016-036/index.html">Paper on The R Journal</a>
    </li>
    <li>
      <a href="articles/index.html">Vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cvitolo/rnrfa/">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rnrfa" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rnrfa" class="anchor"></a>rnrfa</h1></div>
<blockquote>
<p>An R package to Retrieve, Filter and Visualize Data from the UK National River Flow Archive</p>
</blockquote>
<p><a href="https://doi.org/10.5281/zenodo.593201"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.593201.svg" alt="DOI"></a></p>
<p><a href="https://cran.r-project.org/package=rnrfa"><img src="http://www.r-pkg.org/badges/version/rnrfa" alt="CRAN Status Badge"></a> <a href="https://cran.r-project.org/package=rnrfa"><img src="http://cranlogs.r-pkg.org/badges/grand-total/rnrfa" alt="CRAN Total Downloads"></a> <a href="https://cran.r-project.org/package=rnrfa"><img src="http://cranlogs.r-pkg.org/badges/rnrfa" alt="CRAN Monthly Downloads"></a></p>
<p><a href="https://github.com/cvitolo/rnrfa/actions"><img src="https://github.com/cvitolo/rnrfa/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://codecov.io/github/cvitolo/rnrfa?branch=master"><img src="https://codecov.io/gh/cvitolo/rnrfa/master.svg" alt="Coverage Status"></a></p>
<p>The UK National River Flow Archive serves daily streamflow data, spatial rainfall averages and information regarding elevation, geology, land cover and FEH related catchment descriptors.</p>
<p>There is currently an API under development that in future should provide access to the following services: metadata catalogue, catalogue filters based on a geographical bounding-box, catalogue filters based on metadata entries, gauged daily data for about 400 stations available in WaterML2 format, the OGC standard used to describe hydrological time series.</p>
<p>The information returned by the first three services is in JSON format, while the last one is an XML variant.</p>
<p>The RNRFA package aims to achieve a simpler and more efficient access to data by providing wrapper functions to send HTTP requests and interpret XML/JSON responses.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The stable version of the <strong>rnrfa</strong> package is available from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rnrfa"</span><span class="op">)</span></code></pre></div>
<p>Or the development version from GitHub using the package <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"cvitolo/rnrfa"</span><span class="op">)</span></code></pre></div>
<p>Now, load the rnrfa package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://cvitolo.github.io/rnrfa/">rnrfa</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="retrieve-information-for-all-the-stations-in-the-catalogue" class="section level3">
<h3 class="hasAnchor">
<a href="#retrieve-information-for-all-the-stations-in-the-catalogue" class="anchor"></a>Retrieve information for all the stations in the catalogue</h3>
<p>The R function that deals with the NRFA catalogue to retrieve the full list of monitoring stations is called catalogue(). The function, used with no inputs, requests the full list of gauging stations with associated metadata. The output is a dataframe containing one record for each station and as many columns as the number of metadata entries available.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allStations</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/catalogue.html">catalogue</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The same function catalogue() can be used to filter stations based on a bounding box or any of the metadata entries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define a bounding box:</span>
<span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lon_min<span class="op">=</span><span class="op">-</span><span class="fl">3.82</span>, lon_max<span class="op">=</span><span class="op">-</span><span class="fl">3.63</span>, lat_min<span class="op">=</span><span class="fl">52.43</span>, lat_max<span class="op">=</span><span class="fl">52.52</span><span class="op">)</span>

<span class="co"># Filter stations based on bounding box</span>
<span class="va">someStations</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/catalogue.html">catalogue</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></code></pre></div>
</div>
<div id="conversions-of-os-grid-references" class="section level3">
<h3 class="hasAnchor">
<a href="#conversions-of-os-grid-references" class="anchor"></a>Conversions of OS grid references</h3>
<p>The only geospatial information contained in the list of station in the catalogue is the OS grid reference (column “gridRef”). The RNRFA package allows convenient conversion to more standard coordinate systems. The function “osg_parse()”, for example, converts the string to easting and northing in the BNG coordinate system (EPSG code: 27700), as in the example below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Where is the first catchment located?</span>
<span class="va">someStations</span><span class="op">$</span><span class="va">`grid-reference`</span><span class="op">$</span><span class="va">ngr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>

<span class="co"># Convert OS Grid reference to BNG</span>
<span class="fu"><a href="reference/osg_parse.html">osg_parse</a></span><span class="op">(</span>grid_refs <span class="op">=</span> <span class="st">"SN853872"</span><span class="op">)</span></code></pre></div>
<p>The same function can also convert from BNG to latitude and longitude in the WSGS84 coordinate system (EPSG code: 4326) as in the example below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert BNG to WSGS84</span>
<span class="fu"><a href="reference/osg_parse.html">osg_parse</a></span><span class="op">(</span>grid_refs <span class="op">=</span> <span class="st">"SN853872"</span>, coord_system <span class="op">=</span> <span class="st">"WGS84"</span><span class="op">)</span></code></pre></div>
<p>osg_parse() also works with multiple references:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/osg_parse.html">osg_parse</a></span><span class="op">(</span><span class="va">someStations</span><span class="op">$</span><span class="va">`grid-reference`</span><span class="op">$</span><span class="va">ngr</span><span class="op">)</span></code></pre></div>
</div>
<div id="time-series-data" class="section level3">
<h3 class="hasAnchor">
<a href="#time-series-data" class="anchor"></a>Time series data</h3>
<p>The first column of the table “someStations” contains the id number. This can be used to retrieve time series data and convert waterml2 files to time series object (of class zoo).</p>
<p>The National River Flow Archive serves two types of time series data: gauged daily flow and catchment mean rainfall.</p>
<p>Catchment mean rainfall:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cmr.html">cmr</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"3001"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></code></pre></div>
<p>Gauged daily flow:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdf.html">gdf</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"3001"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></code></pre></div>
<p>For more examples and details, please see the <a href="https://github.com/cvitolo/rnrfa/blob/master/vignettes/rnrfa-vignette.Rmd">vignette</a>.</p>
</div>
<div id="terms-and-conditions" class="section level3">
<h3 class="hasAnchor">
<a href="#terms-and-conditions" class="anchor"></a>Terms and Conditions</h3>
<p>Please refer to the following Terms and Conditions for use of NRFA Data and disclaimer: <a href="https://nrfa.ceh.ac.uk/costs-terms-and-conditions" class="uri">https://nrfa.ceh.ac.uk/costs-terms-and-conditions</a></p>
<p>This package uses a non-public API which is likely to change. Package and functions herein are provided as is, without any guarantee.</p>
</div>
<div id="meta" class="section level3">
<h3 class="hasAnchor">
<a href="#meta" class="anchor"></a>Meta</h3>
<ul>
<li>Please <a href="https://github.com/cvitolo/rnrfa/issues">report any issues or bugs</a>.</li>
<li>License: <a href="https://opensource.org/licenses/GPL-3.0">GPL-3</a>
</li>
<li>Get citation information for <code>rnrfa</code> in R doing <code><a href="https://rdrr.io/r/utils/citation.html">citation(package = 'rnrfa')</a></code>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=rnrfa">https://​cloud.r-project.org/​package=rnrfa</a>
</li>
<li>Browse source code at <br><a href="https://github.com/cvitolo/rnrfa/">https://​github.com/​cvitolo/​rnrfa/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/cvitolo/rnrfa/issues">https://​github.com/​cvitolo/​rnrfa/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing rnrfa</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Claudia Vitolo <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4252-1176" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Claudia Vitolo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
